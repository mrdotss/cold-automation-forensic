{% extends 'layouts/base.html' %}

{% block title %}Acquisition {% endblock title %}
{% load static %}
<!-- Specific CSS goes HERE -->
{% block stylesheets %}
    <link rel="stylesheet" href="{% static 'node_modules/ionicons201/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'node_modules/jqvmap/dist/jqvmap.min.css' %}">
    <style>
        .donut-inner {
           margin-top: -200px;
           margin-bottom: 150px;
           margin-left: 190px;
        }
        .donut-inner h3 {
           margin-bottom: 10px;
           margin-top: 0;
        }
        .donut-inner span {
           font-size: 12px;
        }
    </style>
{% endblock stylesheets %}

{% block content %}

    <div class="section-header">
        <h1>Acquisition - [{{ serial_id }}]</h1>
        <div class="section-header-breadcrumb">
          <div class="breadcrumb-item active"><a href="#">Lab</a></div>
          <div class="breadcrumb-item">Device</div>
        </div>
      </div>

    <div class="section-body">
        <div class="row">
          <div class="col-12 mb-4">
            <div class="hero text-white hero-bg-image" data-background="{% static 'assets/img/unsplash/eberhard-grossgasteiger-1207565-unsplash.jpg' %}">
              <div class="hero-inner">
                <h2>Welcome to Acquisition Setup</h2>
{#                <p class="lead"></p>#}
                  <br>

                  {% if isRooted %}
                      <span class="d-inline-block" data-toggle="tooltip"
                          data-title="This device is rooted and can be acquired using physical acquisition."
                          data-placement="bottom">
    
                          <button class="btn btn-light"
                         data-serial-id="{{ serial_id }}" data-toggle="modal"
                         data-target="#physicalModal-{{ serial_id }}">Physical</button>&nbsp;&nbsp;
                      </span>
    
                      <span class="d-inline-block" data-toggle="tooltip"
                          data-title="This device is rooted and can be acquired using full file system acquisition."
                          data-placement="bottom">
    
                          <button class="btn btn-light"
                         data-serial-id="{{ serial_id }}" data-toggle="modal"
                         data-target="#ffsModal-{{ serial_id }}">Full File System</button>&nbsp;&nbsp;
                      </span>
                  {% else %}
                      <span class="d-inline-block" data-toggle="tooltip"
                          data-title="This device is not rooted and can't be acquired using physical acquisition."
                          data-placement="bottom">
    
                          <button class="btn btn-light"
                         data-serial-id="{{ serial_id }}" data-toggle="modal"
                         data-target="#physicalModal-{{ serial_id }}" disabled>Physical</button>&nbsp;&nbsp;
                      </span>
    
                      <span class="d-inline-block" data-toggle="tooltip"
                          data-title="This device is not rooted and can't be acquired using full file system acquisition."
                          data-placement="bottom">
    
                          <button class="btn btn-light"
                         data-serial-id="{{ serial_id }}" data-toggle="modal"
                         data-target="#ffsModal-{{ serial_id }}" disabled>Full File System</button>&nbsp;&nbsp;
                      </span>
                  {% endif %}
              
                  <span class="d-inline-block" data-toggle="tooltip"
                      data-title="[COMING SOON] - this feature will be available soon."
                      data-placement="bottom">

                      <button class="btn btn-light"
                        data-serial-id="{{ serial_id }}" data-toggle="modal"
                        data-target="#logicalleModal-{{ serial_id }}" disabled>Logical</button>
                  </span>

              </div>
            </div>
          </div>

          <div class="col-12 col-md-6 col-lg-4">
            <div class="card card-light">
              <div class="card-header">
                <h4>WhatsApp Acquisition</h4>
                  {% if "com.whatsapp" in appList%}
                      <span class="d-inline-block" data-toggle="tooltip" data-title="WhatsApp installed on this devices.">
                        <button class="btn btn-outline-success pe-none" type="button" disabled>Available</button>
                    </span>
                  {% else %}
                      <span class="d-inline-block" data-toggle="tooltip" data-title="WhatsApp not installed on this devices.">
                        <button class="btn btn-outline-secondary pe-none" type="button" disabled>Not Available</button>
                      </span>
                  {% endif %}
              </div>
              <div class="card-body">
                <p>WhatsApp is a popular cross-platform instant messaging application that allows users to send text
                    messages, make voice calls, and share multimedia content such as photos, videos, and audio files.</p>
{#                  {% if "com.whatsapp" in appList%}#}
{#                      <a href="#" class="btn btn-light">Acquisition Now</a>#}
{#                  {% endif %}#}
              </div>
            </div>
            <div class="col-12">
{#                <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-danger mr-3 rounded" ><i class="fas fa-file"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">167kb</div>#}
{#                          <div class="media-title"><a href="#">design-components.pdf</a></div>#}
{#                          <div class="text-small text-muted">09.14.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
{#                <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-info mr-3 rounded" ><i class="fas fa-code"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">14kb</div>#}
{#                          <div class="media-title"><a href="#">MainFragment.kt</a></div>#}
{#                          <div class="text-small text-muted">09.03.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
{#                <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-info mr-3 rounded" ><i class="fas fa-code"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">72kb</div>#}
{#                          <div class="media-title"><a href="#">MainViewModel.kt</a></div>#}
{#                          <div class="text-small text-muted">08.28.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
{#                <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-danger mr-3 rounded" ><i class="fas fa-file"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">167kb</div>#}
{#                          <div class="media-title"><a href="#">Guidelines.pdf</a></div>#}
{#                          <div class="text-small text-muted">08.26.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
              </div>
          </div>

          <div class="col-12 col-md-6 col-lg-4">
            <div class="card card-light">
              <div class="card-header">
                <h4>Twitter Acquisition</h4>
                  {% if "com.twitter.android" in appList%}
                      <span class="d-inline-block" data-toggle="tooltip" data-title="Twitter installed on this devices.">
                        <button class="btn btn-outline-success pe-none" type="button" disabled>Available</button>
                    </span>
                  {% else %}
                      <span class="d-inline-block" data-toggle="tooltip" data-title="Twitter not installed on this devices.">
                        <button class="btn btn-outline-secondary pe-none" type="button" disabled>Not Available</button>
                      </span>
                  {% endif %}
              </div>
              <div class="card-body">
                <p>Twitter is a microblogging and social media platform that allows users to post short messages,
                    called "tweets", of up to 280 characters.</p>
{#                  {% if "com.twitter.android" in appList%}#}
{#                      <a href="#" class="btn btn-light">Acquisition Now</a>#}
{#                  {% endif %}#}
              </div>
            </div>
              <div class="col-12">
{#                <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-warning mr-3 rounded" ><i class="ion ion-android-archive"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">1.2mb</div>#}
{#                          <div class="media-title"><a href="#">app-info.zip</a></div>#}
{#                          <div class="text-small text-muted">08.02.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
{#                  <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-info mr-3 rounded" ><i class="fas fa-code"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">763kb</div>#}
{#                          <div class="media-title"><a href="#">ContactsViewModel.kt</a></div>#}
{#                          <div class="text-small text-muted">07.26.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
{#                  <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-success mr-3 rounded" ><i class="fas fa-image"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">5.6mb</div>#}
{#                          <div class="media-title"><a href="#">avatar-xl.png</a></div>#}
{#                          <div class="text-small text-muted">07.24.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
{#                  <div class="card">#}
{#                  <div class="card-body">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-success mr-3 rounded" ><i class="fas fa-image"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">1.2mb</div>#}
{#                          <div class="media-title"><a href="#">welcome-login.png</a></div>#}
{#                          <div class="text-small text-muted">06.29.21</div>#}
{#                        </div>#}
{#                      </li>#}
{#                  </div>#}
{#                </div>#}
              </div>
          </div>
          <div class="col-12 col-sm-12 col-lg-4">
            <div class="card">
              <div class="card-body">
                  <h2>Internal Storage</h2>
                <canvas id="myChart4" height="300"></canvas>
                  <div class="donut-inner" data-width="150">
                    <h3>{{ storage.total }} MB</h3>
                    <span>used of {{ storage.used }} MB</span>
                  </div>
{#                  <div class="summary-item">#}
{#                    <ul class="list-unstyled list-unstyled-border">#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-warning mr-3 rounded" ><i class="fas fa-file"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">2.2 GB</div>#}
{#                          <div class="media-title"><a href="#">Document</a></div>#}
{#                          <div class="text-small text-muted">127 Files</div>#}
{#                        </div>#}
{#                      </li>#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-info mr-3 rounded" ><i class="fas fa-image"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">13 GB</div>#}
{#                          <div class="media-title"><a href="#">Photos</a></div>#}
{#                          <div class="text-small text-muted">1335 Files</div>#}
{#                        </div>#}
{#                      </li>#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-danger mr-3 rounded" ><i class="fas fa-video"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">42 GB</div>#}
{#                          <div class="media-title"><a href="#">Videos</a></div>#}
{#                          <div class="text-muted text-small">278 Files</div>#}
{#                        </div>#}
{#                      </li>#}
{#                      <li class="media">#}
{#                        <a href="#" class="btn btn-icon btn-primary mr-3 rounded" ><i class="fas fa-music"></i></a>#}
{#                        <div class="media-body">#}
{#                          <div class="media-right">1.8 GB</div>#}
{#                          <div class="media-title"><a href="#">Musics</a></div>#}
{#                          <div class="text-small text-muted">175 Files</div>#}
{#                        </div>#}
{#                      </li>#}
{#                    </ul>#}
{#                  </div>#}
              </div>
            </div>
          </div>
        </div>
      </div>

{% endblock content %}

{% block modalstuff %}
    <div class="modal fade"  tabindex="-1" role="dialog" id="physicalModal-{{ serial_id }}">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Acquisition Device</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Are you sure want to physical acquisition this devices?<br>deviceID: {{ serial_id }}</p>
          </div>
          <div class="modal-footer bg-whitesmoke br">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button id="goPhysicalAcquisition" class="btn btn-primary confirm-delete-btn"
               data-serial-id="{{ serial_id }}">Yes</button>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade"  tabindex="-1" role="dialog" id="ffsModal-{{ serial_id }}">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Acquisition Device</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Are you sure want to full file system acquisition this devices?<br>deviceID: {{ serial_id }}</p>
          </div>
          <div class="modal-footer bg-whitesmoke br">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button id="goFullFileSystemAcquisition" class="btn btn-primary confirm-delete-btn"
               data-serial-id="{{ serial_id }}">Yes</button>
          </div>
        </div>
      </div>
    </div>
{% endblock modalstuff %}

<!-- Specific JS goes HERE -->
{% block javascripts %}
    <script src="{% static 'assets/js/page/modules-ion-icons.js' %}"></script>
    <script src="{% static 'node_modules/chart.js/dist/Chart.min.js' %}"></script>
    <script src="{% static 'node_modules/jquery-sparkline/jquery.sparkline.min.js' %}"></script>
    <script src="{% static 'assets/js/page/components-statistic.js' %}"></script>
    <script>
        var ctx = document.getElementById("myChart4").getContext('2d');
        var totalStorage = {{ storage.total }};
        var usedStorage = {{ storage.used }};
        var myChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            datasets: [
              {
                label: ["Used", "Available"],
                data: [usedStorage, totalStorage - usedStorage],
                backgroundColor: ["rgba(169, 177, 240, 1)"],
                borderColor: ["rgba(101,117,233,255)"],
                borderWidth: 1
              }
            ]
          },
          options: {
            circumference: Math.PI + 1,
            rotation: -Math.PI - 0.5,
            cutoutPercentage: 64,
            tooltips: {
              callbacks: {
                title: function(tooltipItem, data) {
                  return data['datasets'][0]['label'][tooltipItem['index']];
                },
                label: function(tooltipItem, data) {
                  return data['datasets'][0]['data'][tooltipItem['index']];
                },
                afterLabel: function(tooltipItem, data) {
                  var total = data['datasets'][0]['data'].reduce(function(a, b) { return a + b; }, 0);
                  var value = data['datasets'][0]['data'][tooltipItem['index']];
                  var percent = Math.round((value / total) * 100);
                  return '(' + percent + '%'+')';
                }
              },
              backgroundColor: '#FFF',
              titleFontSize: 16,
              titleFontColor: '#0066ff',
              bodyFontColor: '#000',
              bodyFontSize: 14,
              displayColors: false
            }
          },
        });
    </script>
    
    <script>
        document.getElementById('goPhysicalAcquisition').addEventListener('click', function() {
            fetch('/device/acquisition/{{ serial_id }}/generate-unique-code/physical')
            .then(response => response.json())
            .then(data => {
                if(data.success && data.unique_code) {
                    window.location.href = `/device/acquisition/{{ serial_id }}/setup/${data.unique_code}`;
                } else {
                    alert("Failed to start acquisition process.");
                }
            });
        });
        
        document.getElementById('goFullFileSystemAcquisition').addEventListener('click', function() {
            fetch('/device/acquisition/{{ serial_id }}/generate-unique-code/full-file-system')
            .then(response => response.json())
            .then(data => {
                if(data.success && data.unique_code) {
                    window.location.href = `/device/acquisition/{{ serial_id }}/setup/${data.unique_code}`;
                } else {
                    alert("Failed to start acquisition process.");
                }
            });
        });
    </script>
{% endblock javascripts %}
